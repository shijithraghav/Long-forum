/*!
 * # Semantic UI - Visit
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,n,i){"use strict";e.visit=e.fn.visit=function(n){var a,o=e(e.isFunction(this)?t:this),r=o.selector||"",l=(new Date).getTime(),s=[],c=arguments[0],d="string"==typeof c,u=[].slice.call(arguments,1);return o.each(function(){var m,p=e.isPlainObject(n)?e.extend(!0,{},e.fn.visit.settings,n):e.extend({},e.fn.visit.settings),h=p.error,g=p.namespace,f=g+"-module",b=e(this),v=e(),T=this,E=b.data(f);m={initialize:function(){p.count?m.store(p.key.count,p.count):p.id?m.add.id(p.id):p.increment&&"increment"!==d&&m.increment(),m.add.display(b),m.instantiate()},instantiate:function(){m.verbose("Storing instance of visit module",m),E=m,b.data(f,m)},destroy:function(){m.verbose("Destroying instance"),b.removeData(f)},increment:function(e){var t=m.get.count(),n=+t+1;e?m.add.id(e):(n>p.limit&&!p.surpass&&(n=p.limit),m.debug("Incrementing visits",n),m.store(p.key.count,n))},decrement:function(e){var t=m.get.count(),n=+t-1;e?m.remove.id(e):(m.debug("Removing visit"),m.store(p.key.count,n))},get:{count:function(){return+m.retrieve(p.key.count)||0},idCount:function(e){return e=e||m.get.ids(),e.length},ids:function(e){var t=[];return e=e||m.retrieve(p.key.ids),"string"==typeof e&&(t=e.split(p.delimiter)),m.verbose("Found visited ID list",t),t},storageOptions:function(e){var t={};return p.expires&&(t.expires=p.expires),p.domain&&(t.domain=p.domain),p.path&&(t.path=p.path),t}},has:{visited:function(t,n){var a=!1;return n=n||m.get.ids(),t!==i&&n&&e.each(n,function(e,n){n==t&&(a=!0)}),a}},set:{count:function(e){m.store(p.key.count,e)},ids:function(e){m.store(p.key.ids,e)}},reset:function(){m.store(p.key.count,0),m.store(p.key.ids,null)},add:{id:function(e){var t=m.retrieve(p.key.ids),n=t===i||""===t?e:t+p.delimiter+e;m.has.visited(e)?m.debug("Unique content already visited, not adding visit",e,t):e===i?m.debug("ID is not defined"):(m.debug("Adding visit to unique content",e),m.store(p.key.ids,n)),m.set.count(m.get.idCount())},display:function(t){var n=e(t);n.length>0&&!e.isWindow(n[0])&&(m.debug("Updating visit count for element",n),v=v.length>0?v.add(n):n)}},remove:{id:function(t){var n=m.get.ids(),a=[];t!==i&&n!==i&&(m.debug("Removing visit to unique content",t,n),e.each(n,function(e,n){n!==t&&a.push(n)}),a=a.join(p.delimiter),m.store(p.key.ids,a)),m.set.count(m.get.idCount())}},check:{limit:function(e){e=e||m.get.count(),p.limit&&(e>=p.limit&&(m.debug("Pages viewed exceeded limit, firing callback",e,p.limit),p.onLimit.call(T,e)),m.debug("Limit not reached",e,p.limit),p.onChange.call(T,e)),m.update.display(e)}},update:{display:function(e){e=e||m.get.count(),v.length>0&&(m.debug("Updating displayed view count",v),v.html(e))}},store:function(n,a){var o=m.get.storageOptions(a);if("localstorage"==p.storageMethod&&t.localStorage!==i)t.localStorage.setItem(n,a),m.debug("Value stored using local storage",n,a);else{if(e.cookie===i)return void m.error(h.noCookieStorage);e.cookie(n,a,o),m.debug("Value stored using cookie",n,a,o)}n==p.key.count&&m.check.limit(a)},retrieve:function(n,a){var o;return"localstorage"==p.storageMethod&&t.localStorage!==i?o=t.localStorage.getItem(n):e.cookie!==i?o=e.cookie(n):m.error(h.noCookieStorage),("undefined"==o||"null"==o||o===i||null===o)&&(o=i),o},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,p,t);else{if(n===i)return p[t];p[t]=n}},internal:function(t,n){return m.debug("Changing internal",t,n),n===i?m[t]:void(e.isPlainObject(t)?e.extend(!0,m,t):m[t]=n)},debug:function(){p.debug&&(p.performance?m.performance.log(arguments):(m.debug=Function.prototype.bind.call(console.info,console,p.name+":"),m.debug.apply(console,arguments)))},verbose:function(){p.verbose&&p.debug&&(p.performance?m.performance.log(arguments):(m.verbose=Function.prototype.bind.call(console.info,console,p.name+":"),m.verbose.apply(console,arguments)))},error:function(){m.error=Function.prototype.bind.call(console.error,console,p.name+":"),m.error.apply(console,arguments)},performance:{log:function(e){var t,n,i;p.performance&&(t=(new Date).getTime(),i=l||t,n=t-i,l=t,s.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:T,"Execution Time":n})),clearTimeout(m.performance.timer),m.performance.timer=setTimeout(m.performance.display,500)},display:function(){var t=p.name+":",n=0;l=!1,clearTimeout(m.performance.timer),e.each(s,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",r&&(t+=" '"+r+"'"),o.length>1&&(t+=" ("+o.length+")"),(console.group!==i||console.table!==i)&&s.length>0&&(console.groupCollapsed(t),console.table?console.table(s):e.each(s,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),s=[]}},invoke:function(t,n,o){var r,l,s,c=E;return n=n||u,o=T||o,"string"==typeof t&&c!==i&&(t=t.split(/[\. ]/),r=t.length-1,e.each(t,function(n,a){var o=n!=r?a+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(c[o])&&n!=r)c=c[o];else{if(c[o]!==i)return l=c[o],!1;if(!e.isPlainObject(c[a])||n==r)return c[a]!==i?(l=c[a],!1):!1;c=c[a]}})),e.isFunction(l)?s=l.apply(o,n):l!==i&&(s=l),e.isArray(a)?a.push(s):a!==i?a=[a,s]:s!==i&&(a=s),l}},d?(E===i&&m.initialize(),m.invoke(c)):(E!==i&&E.invoke("destroy"),m.initialize())}),a!==i?a:this},e.fn.visit.settings={name:"Visit",debug:!1,verbose:!1,performance:!0,namespace:"visit",increment:!1,surpass:!1,count:!1,limit:!1,delimiter:"&",storageMethod:"localstorage",key:{count:"visit-count",ids:"visit-ids"},expires:30,domain:!1,path:"/",onLimit:function(){},onChange:function(){},error:{method:"The method you called is not defined",missingPersist:"Using the persist setting requires the inclusion of PersistJS",noCookieStorage:"The default storage cookie requires $.cookie to be included."}}}(jQuery,window,document);