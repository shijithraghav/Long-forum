/*!
 * # Semantic UI - Form Validation
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,n,i){"use strict";e.fn.form=function(t){var a,o=e(this),r=o.selector||"",l=(new Date).getTime(),s=[],c=arguments[0],d=arguments[1],u="string"==typeof c,m=[].slice.call(arguments,1);return o.each(function(){var p,h,g,f,b,v,T,E,y,C,k,I,D,R,O,w,S,_,A=e(this),x=this,K=[],L=!1;_={initialize:function(){_.get.settings(),u?(S===i&&_.instantiate(),_.invoke(c)):(_.verbose("Initializing form validation",A,E),_.bindEvents(),_.set.defaults(),_.instantiate())},instantiate:function(){_.verbose("Storing instance of module",_),S=_,A.data(O,_)},destroy:function(){_.verbose("Destroying previous module",S),_.removeEvents(),A.removeData(O)},refresh:function(){_.verbose("Refreshing selector cache"),p=A.find(k.field),h=A.find(k.group),g=A.find(k.message),f=A.find(k.prompt),b=A.find(k.submit),v=A.find(k.clear),T=A.find(k.reset)},submit:function(){_.verbose("Submitting form",A),A.submit()},attachEvents:function(t,n){n=n||"submit",e(t).on("click"+w,function(e){_[n](),e.preventDefault()})},bindEvents:function(){_.verbose("Attaching form events"),A.on("submit"+w,_.validate.form).on("blur"+w,k.field,_.event.field.blur).on("click"+w,k.submit,_.submit).on("click"+w,k.reset,_.reset).on("click"+w,k.clear,_.clear),E.keyboardShortcuts&&A.on("keydown"+w,k.field,_.event.field.keydown),p.each(function(){var t=e(this),n=t.prop("type"),i=_.get.changeEvent(n,t);e(this).on(i+w,_.event.field.change)})},clear:function(){p.each(function(){var t=e(this),n=t.parent(),i=t.closest(h),a=i.find(k.prompt),o=t.data(C.defaultValue)||"",r=n.is(k.uiCheckbox),l=n.is(k.uiDropdown),s=i.hasClass(I.error);s&&(_.verbose("Resetting error on field",i),i.removeClass(I.error),a.remove()),l?(_.verbose("Resetting dropdown value",n,o),n.dropdown("clear")):r?t.prop("checked",!1):(_.verbose("Resetting field value",t,o),t.val(""))})},reset:function(){p.each(function(){var t=e(this),n=t.parent(),a=t.closest(h),o=a.find(k.prompt),r=t.data(C.defaultValue),l=n.is(k.uiCheckbox),s=n.is(k.uiDropdown),c=a.hasClass(I.error);r!==i&&(c&&(_.verbose("Resetting error on field",a),a.removeClass(I.error),o.remove()),s?(_.verbose("Resetting dropdown value",n,r),n.dropdown("restore defaults")):l?(_.verbose("Resetting checkbox value",n,r),t.prop("checked",r)):(_.verbose("Resetting field value",t,r),t.val(r)))})},is:{valid:function(){var t=!0;return _.verbose("Checking if form is valid"),e.each(y,function(e,n){_.validate.field(n)||(t=!1)}),t}},removeEvents:function(){A.off(w),p.off(w),b.off(w),p.off(w)},event:{field:{keydown:function(t){var n=e(this),i=t.which,a={enter:13,escape:27};i==a.escape&&(_.verbose("Escape key pressed blurring field"),n.blur()),!t.ctrlKey&&i==a.enter&&n.is(k.input)&&n.not(k.checkbox).length>0&&(L||(n.one("keyup"+w,_.event.field.keyup),_.submit(),_.debug("Enter pressed on input submitting form")),L=!0)},keyup:function(){L=!1},blur:function(){var t=e(this),n=t.closest(h),i=_.get.validation(t);n.hasClass(I.error)?(_.debug("Revalidating field",t,i),_.validate.field(i)):("blur"==E.on||"change"==E.on)&&_.validate.field(i)},change:function(){var t=e(this),n=t.closest(h);("change"==E.on||n.hasClass(I.error)&&E.revalidate)&&(clearTimeout(_.timer),_.timer=setTimeout(function(){_.debug("Revalidating field",t,_.get.validation(t)),_.validate.field(_.get.validation(t))},E.delay))}}},get:{changeEvent:function(e,t){return"checkbox"==e||"radio"==e||"hidden"==e||t.is("select")?"change":_.get.inputEvent()},inputEvent:function(){return n.createElement("input").oninput!==i?"input":n.createElement("input").onpropertychange!==i?"propertychange":"keyup"},settings:function(){if(e.isPlainObject(t)){var n=Object.keys(t),a=n.length>0?t[n[0]].identifier!==i&&t[n[0]].rules!==i:!1;a?(E=e.extend(!0,{},e.fn.form.settings,d),y=e.extend({},e.fn.form.settings.defaults,t),_.error(E.error.oldSyntax,x),_.verbose("Extending settings from legacy parameters",y,E)):(E=e.extend(!0,{},e.fn.form.settings,t),y=e.extend({},e.fn.form.settings.defaults,E.fields),_.verbose("Extending settings",y,E))}else E=e.fn.form.settings,y=e.fn.form.settings.defaults,_.verbose("Using default form validation",y,E);R=E.namespace,C=E.metadata,k=E.selector,I=E.className,D=E.error,O="module-"+R,w="."+R,S=A.data(O),_.refresh()},field:function(t){return _.verbose("Finding field with identifier",t),p.filter("#"+t).length>0?p.filter("#"+t):p.filter('[name="'+t+'"]').length>0?p.filter('[name="'+t+'"]'):p.filter('[name="'+t+'[]"]').length>0?p.filter('[name="'+t+'[]"]'):p.filter("[data-"+C.validate+'="'+t+'"]').length>0?p.filter("[data-"+C.validate+'="'+t+'"]'):e("<input/>")},fields:function(t){var n=e();return e.each(t,function(e,t){n=n.add(_.get.field(t))}),n},validation:function(t){var n;return y?(e.each(y,function(e,i){_.get.field(i.identifier)[0]==t[0]&&(n=i)}),n||!1):!1},value:function(e){var t,n=[];return n.push(e),t=_.get.values.call(x,n),t[e]},values:function(t){var n=e.isArray(t)?_.get.fields(t):p,i={};return n.each(function(t,n){var a=e(n),o=(a.prop("type"),a.prop("name")),r=a.val(),l=a.is(k.checkbox),s=a.is(k.radio),c=-1!==o.indexOf("[]"),d=l?a.is(":checked"):!1;o&&(c?(o=o.replace("[]",""),i[o]||(i[o]=[]),l?d?i[o].push(!0):i[o].push(!1):i[o].push(r)):s?d&&(i[o]=r):l?d?i[o]=!0:i[o]=!1:i[o]=r)}),i}},has:{field:function(e){return _.verbose("Checking for existence of a field with identifier",e),"string"!=typeof e&&_.error(D.identifier,e),p.filter("#"+e).length>0?!0:p.filter('[name="'+e+'"]').length>0?!0:p.filter("[data-"+C.validate+'="'+e+'"]').length>0?!0:!1}},add:{prompt:function(t,n){var a=_.get.field(t),o=a.closest(h),r=o.children(k.prompt),l=0!==r.length;n="string"==typeof n?[n]:n,_.verbose("Adding field error state",t),o.addClass(I.error),E.inline&&(l||(r=E.templates.prompt(n),r.appendTo(o)),r.html(n[0]),l?_.verbose("Inline errors are disabled, no inline error added",t):E.transition&&e.fn.transition!==i&&A.transition("is supported")?(_.verbose("Displaying error with css transition",E.transition),r.transition(E.transition+" in",E.duration)):(_.verbose("Displaying error with fallback javascript animation"),r.fadeIn(E.duration)))},errors:function(e){_.debug("Adding form error messages",e),g.html(E.templates.error(e))}},remove:{prompt:function(t){var n=_.get.field(t.identifier),a=n.closest(h),o=a.children(k.prompt);a.removeClass(I.error),E.inline&&o.is(":visible")&&(_.verbose("Removing prompt for field",t),E.transition&&e.fn.transition!==i&&A.transition("is supported")?o.transition(E.transition+" out",E.duration,function(){o.remove()}):o.fadeOut(E.duration,function(){o.remove()}))}},set:{success:function(){A.removeClass(I.error).addClass(I.success)},defaults:function(){p.each(function(){var t=e(this),n=t.filter(k.checkbox).length>0,i=n?t.is(":checked"):t.val();t.data(C.defaultValue,i)})},error:function(){A.removeClass(I.success).addClass(I.error)},value:function(e,t){var n={};return n[e]=t,_.set.values.call(x,n)},values:function(t){e.isEmptyObject(t)||e.each(t,function(t,n){var i,a=_.get.field(t),o=a.parent(),r=e.isArray(n),l=o.is(k.uiCheckbox),s=o.is(k.uiDropdown),c=a.is(k.radio)&&l,d=a.length>0;d&&(r&&l?(_.verbose("Selecting multiple",n,a),o.checkbox("uncheck"),e.each(n,function(e,t){i=a.filter('[value="'+t+'"]'),o=i.parent(),i.length>0&&o.checkbox("check")})):c?(_.verbose("Selecting radio value",n,a),a.filter('[value="'+n+'"]').parent(k.uiCheckbox).checkbox("check")):l?(_.verbose("Setting checkbox value",n,o),n===!0?o.checkbox("check"):o.checkbox("uncheck")):s?(_.verbose("Setting dropdown value",n,o),o.dropdown("set selected",n)):(_.verbose("Setting field value",n,a),a.val(n)))})}},validate:{form:function(e){var t=_.get.values();return L?!1:(K=[],_.is.valid()?(_.debug("Form has no validation errors, submitting"),_.set.success(),E.onSuccess.call(x,e,t)):(_.debug("Form has errors"),_.set.error(),E.inline||_.add.errors(K),A.data("moduleApi")!==i&&e.stopImmediatePropagation(),E.onFailure.call(x,K,t)))},field:function(t){var n=_.get.field(t.identifier),a=!0,o=[];return n.prop("disabled")?(_.debug("Field is disabled. Skipping",t.identifier),a=!0):t.optional&&""===e.trim(n.val())?(_.debug("Field is optional and empty. Skipping",t.identifier),a=!0):t.rules!==i&&e.each(t.rules,function(e,n){_.has.field(t.identifier)&&!_.validate.rule(t,n)&&(_.debug("Field is invalid",t.identifier,n.type),o.push(n.prompt),a=!1)}),a?(_.remove.prompt(t,o),E.onValid.call(n),!0):(K=K.concat(o),_.add.prompt(t.identifier,o),E.onInvalid.call(n,o),!1)},rule:function(t,n){var a,o,r,l=_.get.field(t.identifier),s=n.type,c=l.val(),d=s.match(E.regExp.bracket),u=!0;if(c=c===i||""===c||null===c?"":e.trim(c+""),d){if(o=""+d[1],r=s.replace(d[0],""),a=E.rules[r],!e.isFunction(a))return void _.error(D.noRule,r);u=a.call(l,c,o)}else{if(a=E.rules[s],!e.isFunction(a))return void _.error(D.noRule,s);u=a.call(l,c)}return u}},setting:function(t,n){if(e.isPlainObject(t))e.extend(!0,E,t);else{if(n===i)return E[t];E[t]=n}},internal:function(t,n){if(e.isPlainObject(t))e.extend(!0,_,t);else{if(n===i)return _[t];_[t]=n}},debug:function(){E.debug&&(E.performance?_.performance.log(arguments):(_.debug=Function.prototype.bind.call(console.info,console,E.name+":"),_.debug.apply(console,arguments)))},verbose:function(){E.verbose&&E.debug&&(E.performance?_.performance.log(arguments):(_.verbose=Function.prototype.bind.call(console.info,console,E.name+":"),_.verbose.apply(console,arguments)))},error:function(){_.error=Function.prototype.bind.call(console.error,console,E.name+":"),_.error.apply(console,arguments)},performance:{log:function(e){var t,n,i;E.performance&&(t=(new Date).getTime(),i=l||t,n=t-i,l=t,s.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:x,"Execution Time":n})),clearTimeout(_.performance.timer),_.performance.timer=setTimeout(_.performance.display,500)},display:function(){var t=E.name+":",n=0;l=!1,clearTimeout(_.performance.timer),e.each(s,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",r&&(t+=" '"+r+"'"),o.length>1&&(t+=" ("+o.length+")"),(console.group!==i||console.table!==i)&&s.length>0&&(console.groupCollapsed(t),console.table?console.table(s):e.each(s,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),s=[]}},invoke:function(t,n,o){var r,l,s,c=S;return n=n||m,o=x||o,"string"==typeof t&&c!==i&&(t=t.split(/[\. ]/),r=t.length-1,e.each(t,function(n,a){var o=n!=r?a+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(c[o])&&n!=r)c=c[o];else{if(c[o]!==i)return l=c[o],!1;if(!e.isPlainObject(c[a])||n==r)return c[a]!==i?(l=c[a],!1):!1;c=c[a]}})),e.isFunction(l)?s=l.apply(o,n):l!==i&&(s=l),e.isArray(a)?a.push(s):a!==i?a=[a,s]:s!==i&&(a=s),l}},_.initialize()}),a!==i?a:this},e.fn.form.settings={name:"Form",namespace:"form",debug:!1,verbose:!1,performance:!0,fields:!1,keyboardShortcuts:!0,on:"submit",inline:!1,delay:200,revalidate:!0,transition:"scale",duration:200,onValid:function(){},onInvalid:function(){},onSuccess:function(){return!0},onFailure:function(){return!1},metadata:{defaultValue:"default",validate:"validate"},regExp:{bracket:/\[(.*)\]/i,decimal:/^\-?\d*(\.\d+)?$/,email:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,flags:/^\/(.*)\/(.*)?/,integer:/^\-?\d+$/,number:/^\-?\d*(\.\d+)?$/,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/i},selector:{checkbox:'input[type="checkbox"], input[type="radio"]',clear:".clear",field:"input, textarea, select",group:".field",input:"input",message:".error.message",prompt:".prompt.label",radio:'input[type="radio"]',reset:'.reset:not([type="reset"])',submit:'.submit:not([type="submit"])',uiCheckbox:".ui.checkbox",uiDropdown:".ui.dropdown"},className:{error:"error",label:"ui prompt label",pressed:"down",success:"success"},error:{identifier:"You must specify a string identifier for each field",method:"The method you called is not defined.",noRule:"There is no rule matching the one you specified",oldSyntax:"Starting in 2.0 forms now only take a single settings object. Validation settings converted to new syntax automatically."},templates:{error:function(t){var n='<ul class="list">';return e.each(t,function(e,t){n+="<li>"+t+"</li>"}),n+="</ul>",e(n)},prompt:function(t){return e("<div/>").addClass("ui basic red pointing prompt label").html(t[0])}},rules:{empty:function(t){return!(t===i||""===t||e.isArray(t)&&0===t.length)},checked:function(){return e(this).filter(":checked").length>0},email:function(t){var n=new RegExp(e.fn.form.settings.regExp.email,"i");return n.test(t)},url:function(t){return e.fn.form.settings.regExp.url.test(t)},regExp:function(t,n){var i,a=n.match(e.fn.form.settings.regExp.flags);return a&&(n=a.length>=2?a[1]:n,i=a.length>=3?a[2]:""),t.match(new RegExp(n,i))},integer:function(t,n){var a,o,r,l=e.fn.form.settings.regExp.integer;return n===i||""===n||".."===n||(-1==n.indexOf("..")?l.test(n)&&(a=o=n-0):(r=n.split("..",2),l.test(r[0])&&(a=r[0]-0),l.test(r[1])&&(o=r[1]-0))),l.test(t)&&(a===i||t>=a)&&(o===i||o>=t)},decimal:function(t){return e.fn.form.settings.regExp.decimal.test(t)},number:function(t){return e.fn.form.settings.regExp.number.test(t)},is:function(e,t){return t="string"==typeof t?t.toLowerCase():t,e="string"==typeof e?e.toLowerCase():e,e==t},isExactly:function(e,t){return e==t},not:function(e,t){return e="string"==typeof e?e.toLowerCase():e,t="string"==typeof t?t.toLowerCase():t,e!=t},notExactly:function(e,t){return e!=t},contains:function(t,n){return n=n.replace(e.fn.form.settings.regExp.escape,"\\$&"),-1!==t.search(new RegExp(n,"i"))},containsExactly:function(t,n){return n=n.replace(e.fn.form.settings.regExp.escape,"\\$&"),-1!==t.search(new RegExp(n))},doesntContain:function(t,n){return n=n.replace(e.fn.form.settings.regExp.escape,"\\$&"),-1===t.search(new RegExp(n,"i"))},doesntContainExactly:function(t,n){return n=n.replace(e.fn.form.settings.regExp.escape,"\\$&"),-1===t.search(new RegExp(n))},minLength:function(e,t){return e!==i?e.length>=t:!1},length:function(e,t){return e!==i?e.length>=t:!1},exactLength:function(e,t){return e!==i?e.length==t:!1},maxLength:function(e,t){return e!==i?e.length<=t:!1},match:function(t,n){var a;e(this);return e('[data-validate="'+n+'"]').length>0?a=e('[data-validate="'+n+'"]').val():e("#"+n).length>0?a=e("#"+n).val():e('[name="'+n+'"]').length>0?a=e('[name="'+n+'"]').val():e('[name="'+n+'[]"]').length>0&&(a=e('[name="'+n+'[]"]')),a!==i?t.toString()==a.toString():!1},creditCard:function(t,n){var i,a,o={visa:{pattern:/^4/,length:[16]},amex:{pattern:/^3[47]/,length:[15]},mastercard:{pattern:/^5[1-5]/,length:[16]},discover:{pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,length:[16]},unionPay:{pattern:/^(62|88)/,length:[16,17,18,19]},jcb:{pattern:/^35(2[89]|[3-8][0-9])/,length:[16]},maestro:{pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,length:[12,13,14,15,16,17,18,19]},dinersClub:{pattern:/^(30[0-5]|^36)/,length:[14]},laser:{pattern:/^(6304|670[69]|6771)/,length:[16,17,18,19]},visaElectron:{pattern:/^(4026|417500|4508|4844|491(3|7))/,length:[16]}},r={},l=!1,s="string"==typeof n?n.split(","):!1;if("string"==typeof t&&0!==t.length){if(s&&(e.each(s,function(n,i){a=o[i],a&&(r={length:-1!==e.inArray(t.length,a.length),pattern:-1!==t.search(a.pattern)},r.length&&r.pattern&&(l=!0))}),!l))return!1;if(i={number:-1!==e.inArray(t.length,o.unionPay.length),pattern:-1!==t.search(o.unionPay.pattern)},i.number&&i.pattern)return!0;for(var c=t.length,d=0,u=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],m=0;c--;)m+=u[d][parseInt(t.charAt(c),10)],d^=1;return m%10===0&&m>0}},different:function(t,n){var a;e(this);return e('[data-validate="'+n+'"]').length>0?a=e('[data-validate="'+n+'"]').val():e("#"+n).length>0?a=e("#"+n).val():e('[name="'+n+'"]').length>0?a=e('[name="'+n+'"]').val():e('[name="'+n+'[]"]').length>0&&(a=e('[name="'+n+'[]"]')),a!==i?t.toString()!==a.toString():!1},exactCount:function(e,t){return 0==t?""===e:1==t?""!==e&&-1===e.search(","):e.split(",").length==t},minCount:function(e,t){return 0==t?!0:1==t?""!==e:e.split(",").length>=t},maxCount:function(e,t){return 0==t?!1:1==t?-1===e.search(","):e.split(",").length<=t}}}}(jQuery,window,document);