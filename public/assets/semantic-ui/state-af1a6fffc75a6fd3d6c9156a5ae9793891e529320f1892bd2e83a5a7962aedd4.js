/*!
 * # Semantic UI - State
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,n,i){"use strict";e.fn.state=function(t){var a,o=e(this),r=o.selector||"",l=("ontouchstart"in n.documentElement,(new Date).getTime()),s=[],c=arguments[0],d="string"==typeof c,u=[].slice.call(arguments,1);return o.each(function(){var n,m=e.isPlainObject(t)?e.extend(!0,{},e.fn.state.settings,t):e.extend({},e.fn.state.settings),p=m.error,h=m.metadata,g=m.className,f=m.namespace,b=m.states,v=m.text,T="."+f,E=f+"-module",y=e(this),C=this,k=y.data(E);n={initialize:function(){n.verbose("Initializing module"),m.automatic&&n.add.defaults(),m.context&&""!==r?e(m.context).on(r,"mouseenter"+T,n.change.text).on(r,"mouseleave"+T,n.reset.text).on(r,"click"+T,n.toggle.state):y.on("mouseenter"+T,n.change.text).on("mouseleave"+T,n.reset.text).on("click"+T,n.toggle.state),n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n),k=n,y.data(E,n)},destroy:function(){n.verbose("Destroying previous module",k),y.off(T).removeData(E)},refresh:function(){n.verbose("Refreshing selector cache"),y=e(C)},add:{defaults:function(){var a=t&&e.isPlainObject(t.states)?t.states:{};e.each(m.defaults,function(t,o){n.is[t]!==i&&n.is[t]()&&(n.verbose("Adding default states",t,C),e.extend(m.states,o,a))})}},is:{active:function(){return y.hasClass(g.active)},loading:function(){return y.hasClass(g.loading)},inactive:function(){return!y.hasClass(g.active)},state:function(e){return g[e]===i?!1:y.hasClass(g[e])},enabled:function(){return!y.is(m.filter.active)},disabled:function(){return y.is(m.filter.active)},textEnabled:function(){return!y.is(m.filter.text)},button:function(){return y.is(".button:not(a, .submit)")},input:function(){return y.is("input")},progress:function(){return y.is(".ui.progress")}},allow:function(e){n.debug("Now allowing state",e),b[e]=!0},disallow:function(e){n.debug("No longer allowing",e),b[e]=!1},allows:function(e){return b[e]||!1},enable:function(){y.removeClass(g.disabled)},disable:function(){y.addClass(g.disabled)},setState:function(e){n.allows(e)&&y.addClass(g[e])},removeState:function(e){n.allows(e)&&y.removeClass(g[e])},toggle:{state:function(){var t,a;if(n.allows("active")&&n.is.enabled()){if(n.refresh(),e.fn.api!==i)if(t=y.api("get request"),a=y.api("was cancelled"))n.debug("API Request cancelled by beforesend"),m.activateTest=function(){return!1},m.deactivateTest=function(){return!1};else if(t)return void n.listenTo(t);n.change.state()}}},listenTo:function(t){n.debug("API request detected, waiting for state signal",t),t&&(v.loading&&n.update.text(v.loading),e.when(t).then(function(){"resolved"==t.state()?(n.debug("API request succeeded"),m.activateTest=function(){return!0},m.deactivateTest=function(){return!0}):(n.debug("API request failed"),m.activateTest=function(){return!1},m.deactivateTest=function(){return!1}),n.change.state()}))},change:{state:function(){n.debug("Determining state change direction"),n.is.inactive()?n.activate():n.deactivate(),m.sync&&n.sync(),m.onChange.call(C)},text:function(){n.is.textEnabled()&&(n.is.disabled()?(n.verbose("Changing text to disabled text",v.hover),n.update.text(v.disabled)):n.is.active()?v.hover?(n.verbose("Changing text to hover text",v.hover),n.update.text(v.hover)):v.deactivate&&(n.verbose("Changing text to deactivating text",v.deactivate),n.update.text(v.deactivate)):v.hover?(n.verbose("Changing text to hover text",v.hover),n.update.text(v.hover)):v.activate&&(n.verbose("Changing text to activating text",v.activate),n.update.text(v.activate)))}},activate:function(){m.activateTest.call(C)&&(n.debug("Setting state to active"),y.addClass(g.active),n.update.text(v.active),m.onActivate.call(C))},deactivate:function(){m.deactivateTest.call(C)&&(n.debug("Setting state to inactive"),y.removeClass(g.active),n.update.text(v.inactive),m.onDeactivate.call(C))},sync:function(){n.verbose("Syncing other buttons to current state"),n.is.active()?o.not(y).state("activate"):o.not(y).state("deactivate")},get:{text:function(){return m.selector.text?y.find(m.selector.text).text():y.html()},textFor:function(e){return v[e]||!1}},flash:{text:function(e,t,i){var a=n.get.text();n.debug("Flashing text message",e,t),e=e||m.text.flash,t=t||m.flashDuration,i=i||function(){},n.update.text(e),setTimeout(function(){n.update.text(a),i.call(C)},t)}},reset:{text:function(){var e=v.active||y.data(h.storedText),t=v.inactive||y.data(h.storedText);n.is.textEnabled()&&(n.is.active()&&e?(n.verbose("Resetting active text",e),n.update.text(e)):t&&(n.verbose("Resetting inactive text",e),n.update.text(t)))}},update:{text:function(e){var t=n.get.text();e&&e!==t?(n.debug("Updating text",e),m.selector.text?y.data(h.storedText,e).find(m.selector.text).text(e):y.data(h.storedText,e).html(e)):n.debug("Text is already set, ignoring update",e)}},setting:function(t,a){if(n.debug("Changing setting",t,a),e.isPlainObject(t))e.extend(!0,m,t);else{if(a===i)return m[t];m[t]=a}},internal:function(t,a){if(e.isPlainObject(t))e.extend(!0,n,t);else{if(a===i)return n[t];n[t]=a}},debug:function(){m.debug&&(m.performance?n.performance.log(arguments):(n.debug=Function.prototype.bind.call(console.info,console,m.name+":"),n.debug.apply(console,arguments)))},verbose:function(){m.verbose&&m.debug&&(m.performance?n.performance.log(arguments):(n.verbose=Function.prototype.bind.call(console.info,console,m.name+":"),n.verbose.apply(console,arguments)))},error:function(){n.error=Function.prototype.bind.call(console.error,console,m.name+":"),n.error.apply(console,arguments)},performance:{log:function(e){var t,i,a;m.performance&&(t=(new Date).getTime(),a=l||t,i=t-a,l=t,s.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:C,"Execution Time":i})),clearTimeout(n.performance.timer),n.performance.timer=setTimeout(n.performance.display,500)},display:function(){var t=m.name+":",a=0;l=!1,clearTimeout(n.performance.timer),e.each(s,function(e,t){a+=t["Execution Time"]}),t+=" "+a+"ms",r&&(t+=" '"+r+"'"),(console.group!==i||console.table!==i)&&s.length>0&&(console.groupCollapsed(t),console.table?console.table(s):e.each(s,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),s=[]}},invoke:function(t,o,r){var l,s,c,d=k;return o=o||u,r=C||r,"string"==typeof t&&d!==i&&(t=t.split(/[\. ]/),l=t.length-1,e.each(t,function(a,o){var r=a!=l?o+t[a+1].charAt(0).toUpperCase()+t[a+1].slice(1):t;if(e.isPlainObject(d[r])&&a!=l)d=d[r];else{if(d[r]!==i)return s=d[r],!1;if(!e.isPlainObject(d[o])||a==l)return d[o]!==i?(s=d[o],!1):(n.error(p.method,t),!1);d=d[o]}})),e.isFunction(s)?c=s.apply(r,o):s!==i&&(c=s),e.isArray(a)?a.push(c):a!==i?a=[a,c]:c!==i&&(a=c),s}},d?(k===i&&n.initialize(),n.invoke(c)):(k!==i&&k.invoke("destroy"),n.initialize())}),a!==i?a:this},e.fn.state.settings={name:"State",debug:!1,verbose:!1,namespace:"state",performance:!0,onActivate:function(){},onDeactivate:function(){},onChange:function(){},activateTest:function(){return!0},deactivateTest:function(){return!0},automatic:!0,sync:!1,flashDuration:1e3,filter:{text:".loading, .disabled",active:".disabled"},context:!1,error:{beforeSend:"The before send function has cancelled state change",method:"The method you called is not defined."},metadata:{promise:"promise",storedText:"stored-text"},className:{active:"active",disabled:"disabled",error:"error",loading:"loading",success:"success",warning:"warning"},selector:{text:!1},defaults:{input:{disabled:!0,loading:!0,active:!0},button:{disabled:!0,loading:!0,active:!0},progress:{active:!0,success:!0,warning:!0,error:!0}},states:{active:!0,disabled:!0,error:!0,loading:!0,success:!0,warning:!0},text:{disabled:!1,flash:!1,hover:!1,active:!1,inactive:!1,activate:!1,deactivate:!1}}}(jQuery,window,document);