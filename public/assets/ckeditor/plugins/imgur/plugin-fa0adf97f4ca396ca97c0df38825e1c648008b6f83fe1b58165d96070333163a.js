!function(){CKEDITOR.plugins.add("imgur",{lang:["zh","en"],init:function(e){ClientID=e.config.imgurClientID,ClientID||alert(e.lang.imgur.ClientIDMissing);var t=0,n=$("<div></div>").css({position:"absolute",bottom:0,left:0,right:0,backgroundColor:"rgba(20, 20, 20, .6)",padding:5,color:"#fff"}).hide();e.on("instanceReady",function(){var t=$(e.window.getFrame().$).parent();t.css({position:"relative"}),n.appendTo(t)}),e.ui.addButton("Imgur",{label:e.lang.imgur.label,toolbar:"insert",command:"imgur",icon:this.path+"images/icon.png"}),e.addCommand("imgur",{exec:function(){$input=$('<input type="file" multiple/>'),$input.on("change",function(i){files=i.target.files,$.each(files,function(i,a){t++,form=new FormData,form.append("image",a),$.ajax({url:"https://api.imgur.com/3/image",headers:{Authorization:"Client-ID "+ClientID},type:"POST",data:form,cache:!1,contentType:!1,processData:!1}).always(function(i){if(t--,n.text(t+e.lang.imgur.uploading).toggle(0!=t),200!=i.status?res=$.parseJSON(i.responseText):res=i,res.data.error)alert(e.lang.imgur.failToUpload+res.data.error);else{content='<img src="'+res.data.link+'"/>';var a=CKEDITOR.dom.element.createFromHtml(content);e.insertElement(a)}})}),n.text(t+e.lang.imgur.uploading).fadeIn()}),$input.click()}})}})}();